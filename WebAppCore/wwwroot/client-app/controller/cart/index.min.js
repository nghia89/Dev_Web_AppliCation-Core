var CartController = function () { var t = { colors: [] }; function r() { $("#headerCart").load("/AjaxContent/HeaderCart") } function n() { return $.ajax({ url: "/Cart/GetCart", type: "GET", dataType: "json", success: function (r) { var n = $("#template-cart").html(), e = "", a = 0; $.each(r, function (r, o) { var s, c; e += Mustache.render(n, { ProductId: o.Product.Id, ProductName: o.Product.Name, Image: o.Product.Image, Price: structures.formatNumber(o.Price, 0), Quantity: o.Quantity, Colors: (s = null === o.Color ? 0 : o.Color.Id, c = "<select class='form-control ddlColorId'><option value='0'></option>", $.each(t.colors, function (t, r) { s === r.Id ? c += '<option value="' + r.Id + '" selected="select">' + r.Name + "</option>" : c += '<option value="' + r.Id + '">' + r.Name + "</option>" }), c += "</select>"), Amount: structures.formatNumber(o.Price * o.Quantity, 0), Url: "/" + o.Product.SeoAlias + "-p." + o.Product.Id + ".html" }), a += o.Price * o.Quantity }), $("#lblTotalAmount").text(structures.formatNumber(a, 0)), "" !== e ? $("#table-cart-content").html(e) : $("#table-cart-content").html("Bạn không có sản phẩm trong giỏ hàng") } }), !1 } this.initialize = function () { $.when($.ajax({ type: "GET", url: "/Cart/GetColors", dataType: "json", success: function (r) { t.colors = r }, error: function () { structures.notify("Có lỗi trong tiến trình", "error") } })).then(function () { n() }), $("body").on("click", ".btn-delete", function (t) { t.preventDefault(); var e = $(this).data("id"); $.ajax({ url: "/Cart/RemoveFromCart", type: "post", data: { productId: e }, success: function () { structures.notify("Loại bỏ sản phẩm là thành công.", "success"), r(), n() } }) }), $("body").on("keyup", ".txtQuantity", function (t) { t.preventDefault(); var e = $(this).data("id"), a = $(this).val(); a > 0 ? $.ajax({ url: "/Cart/UpdateCart", type: "post", data: { productId: e, quantity: a }, success: function () { structures.notify("Cập nhật số lượng thành công", "success"), r(), n() } }) : structures.notify("Số lượng của bạn không hợp lệ", "error") }), $("body").on("change", ".ddlColorId", function (t) { t.preventDefault(); var e = parseInt($(this).closest("tr").data("id")), a = $(this).val(), o = $(this).closest("tr").find(".txtQuantity").first().val(), s = $(this).closest("tr").find(".ddlSizeId").first().val(); o > 0 ? $.ajax({ url: "/Cart/UpdateCart", type: "post", data: { productId: e, quantity: o, color: a, size: s }, success: function () { structures.notify("Cập nhật số lượng thành công", "success"), r(), n() } }) : structures.notify("Số lượng của bạn không hợp lệ", "error") }), $("body").on("change", ".ddlSizeId", function (t) { t.preventDefault(); var e = parseInt($(this).closest("tr").data("id")), a = $(this).val(), o = parseInt($(this).closest("tr").find(".txtQuantity").first().val()), s = parseInt($(this).closest("tr").find(".ddlColorId").first().val()); o > 0 ? $.ajax({ url: "/Cart/UpdateCart", type: "post", data: { productId: e, quantity: o, color: s, size: a }, success: function () { structures.notify("Cập nhật số lượng thành công", "success"), r(), n() } }) : structures.notify("Số lượng của bạn không hợp lệ", "error") }), $("#btnClearAll").on("click", function (t) { t.preventDefault(), $.ajax({ url: "/Cart/ClearCart", type: "post", success: function () { structures.notify("Xóa giỏ hàng thành công", "success"), r(), n() } }) }) } };