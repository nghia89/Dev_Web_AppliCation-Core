var BillController=function(){function e(){$("#txtFromDate, #txtToDate").datepicker({autoclose:!0,format:"dd/mm/yyyy"});$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"vi",rules:{txtCustomerName:{required:!0},txtCustomerAddress:{required:!0},txtCustomerMobile:{required:!0},txtCustomerMessage:{required:!0},ddlBillStatus:{required:!0}}});$("#txt-search-keyword").keypress(function(n){n.which===13&&(n.preventDefault(),t())});$("#btn-search").on("click",function(){t()});$("#btn-create").on("click",function(){f();$("#modal-detail").modal("show")});$("#ddl-show-page").on("change",function(){structures.configs.pageSize=$(this).val();structures.configs.pageIndex=1;t(!0)});$("body").on("click",".btn-view",function(n){n.preventDefault();var t=$(this).data("id");$.ajax({type:"GET",url:"/Admin/Bill/GetById",data:{id:t},beforeSend:function(){structures.startLoading()},success:function(n){var t=n,f,e,o;$("#hidId").val(t.Id);$("#txtCustomerName").val(t.CustomerName);$("#txtCustomerAddress").val(t.CustomerAddress);$("#txtCustomerMobile").val(t.CustomerMobile);$("#txtCustomerMessage").val(t.CustomerMessage);$("#ddlPaymentMethod").val(t.PaymentMethod);$("#ddlCustomerId").val(t.CustomerId);$("#ddlBillStatus").val(t.BillStatus);f=t.BillDetails;l(f);t.BillDetails!==null&&t.BillDetails.length>0&&(e="",o=$("#template-table-bill-details").html(),$.each(f,function(n,t){var f=i(t.ProductId),s=r(t.ColorId),h=u(t.SizeId);e+=Mustache.render(o,{Id:t.Id,Products:f,Colors:s,Sizes:h,Quantity:t.Quantity})}),$("#tbl-bill-details").html(e));$("#modal-detail").modal("show");structures.stopLoading()},error:function(){structures.notify("Has an error in progress","error");structures.stopLoading()}})});$("#btnSave").on("click",function(n){if($("#frmMaintainance").valid()){n.preventDefault();var i=$("#hidId").val(),u=$("#txtCustomerName").val(),e=$("#txtCustomerAddress").val(),o=$("#ddlCustomerId").val(),s=$("#txtCustomerMobile").val(),h=$("#txtCustomerMessage").val(),c=$("#ddlPaymentMethod").val(),l=$("#ddlBillStatus").val(),r=[];return $.each($("#tbl-bill-details tr"),function(n,t){r.push({Id:$(t).data("id"),ProductId:$(t).find("select.ddlProductId").first().val(),Quantity:$(t).find("input.txtQuantity").first().val(),ColorId:$(t).find("select.ddlColorId").first().val(),SizeId:$(t).find("select.ddlSizeId").first().val(),BillId:i})}),$.ajax({type:"POST",url:"/Admin/Bill/SaveEntity",data:{Id:i,BillStatus:l,CustomerAddress:e,CustomerId:o,CustomerMessage:h,CustomerMobile:s,CustomerName:u,PaymentMethod:c,Status:1,BillDetails:r},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Save order successful","success");$("#modal-detail").modal("hide");f();structures.stopLoading();t(!0)},error:function(){structures.notify("Has an error in progress","error");structures.stopLoading()}}),!1}});$("#btnAddDetail").on("click",function(){var n=$("#template-table-bill-details").html(),t=i(null),f=r(null),e=u(null),o=Mustache.render(n,{Id:0,Products:t,Colors:f,Sizes:e,Quantity:0,Total:0});$("#tbl-bill-details").append(o)});$("body").on("click",".btn-delete-detail",function(){$(this).parent().parent().remove()});$("#btnExport").on("click",function(){var n=$("#hidId").val();$.ajax({type:"POST",url:"/Admin/Bill/ExportExcel",data:{billId:n},beforeSend:function(){structures.startLoading()},success:function(n){window.location.href=n;structures.stopLoading()}})})}function o(){return $.ajax({type:"GET",url:"/admin/bill/GetBillStatus",dataType:"json",success:function(t){n.billStatuses=t;var i="";$.each(t,function(n,t){i+="<option value='"+t.Value+"'>"+t.Name+"<\/option>"});$("#ddlBillStatus").html(i)}})}function s(){return $.ajax({type:"GET",url:"/admin/bill/GetPaymentMethod",dataType:"json",success:function(t){n.paymentMethods=t;var i="";$.each(t,function(n,t){i+="<option value='"+t.Value+"'>"+t.Name+"<\/option>"});$("#ddlPaymentMethod").html(i)}})}function h(){return $.ajax({type:"GET",url:"/Admin/Bill/GetColors",dataType:"json",success:function(t){n.colors=t},error:function(){structures.notify("Has an error in progress","error")}})}function c(){return $.ajax({type:"GET",url:"/Admin/Bill/GetSizes",dataType:"json",success:function(t){n.sizes=t},error:function(){structures.notify("Has an error in progress","error")}})}function i(t){var i="<select class='form-control ddlProductId'>";return $.each(n.products,function(n,r){i+=t===r.Id?'<option value="'+r.Id+'" selected="select">'+r.Name+"<\/option>":'<option value="'+r.Id+'">'+r.Name+"<\/option>"}),i+="<\/select>"}function l(t){var i=[];$.each(t,function(n,t){i.push(t.Product)});n.products=i}function r(t){var i="<select class='form-control ddlColorId'>";return $.each(n.colors,function(n,r){i+=t===r.Id?'<option value="'+r.Id+'" selected="select">'+r.Name+"<\/option>":'<option value="'+r.Id+'">'+r.Name+"<\/option>"}),i+="<\/select>"}function u(t){var i="<select class='form-control ddlSizeId'>";return $.each(n.sizes,function(n,r){i+=t===r.Id?'<option value="'+r.Id+'" selected="select">'+r.Name+"<\/option>":'<option value="'+r.Id+'">'+r.Name+"<\/option>"}),i+="<\/select>"}function f(){$("#hidId").val(0);$("#txtCustomerName").val("");$("#txtCustomerAddress").val("");$("#txtCustomerMobile").val("");$("#txtCustomerMessage").val("");$("#ddlPaymentMethod").val("");$("#ddlCustomerId").val("");$("#ddlBillStatus").val("");$("#tbl-bill-details").html("")}function t(n){$.ajax({type:"GET",url:"/admin/bill/GetAllPaging",data:{startDate:$("#txtFromDate").val(),endDate:$("#txtToDate").val(),keyword:$("#txtSearchKeyword").val(),page:structures.configs.pageIndex,pageSize:structures.configs.pageSize},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(i){var u=$("#table-template").html(),r="";i.RowCount>0?($.each(i.Results,function(n,t){r+=Mustache.render(u,{CustomerName:t.CustomerName,Id:t.Id,PaymentMethod:a(t.PaymentMethod),DateCreated:structures.dateTimeFormatJson(t.DateCreated),BillStatus:v(t.BillStatus)})}),$("#lbl-total-records").text(i.RowCount),r!==undefined&&$("#tbl-content").html(r),y(i.RowCount,function(){t()},n)):($("#lbl-total-records").text("0"),$("#tbl-content").html(""));structures.stopLoading()},error:function(n){console.log(n)}})}function a(t){var i=$.grep(n.paymentMethods,function(n){return n.Value===t});return i.length>0?i[0].Name:""}function v(t){var i=$.grep(n.billStatuses,function(n){return n.Value===t});return i.length>0?i[0].Name:""}function y(n,t,i){var r=Math.ceil(n/structures.configs.pageSize);($("#paginationUL a").length===0||i===!0)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page"));$("#paginationUL").twbsPagination({totalPages:r,visiblePages:7,first:"Đầu",prev:"Trước",next:"Tiếp",last:"Cuối",onPageClick:function(n,i){structures.configs.pageIndex=i;setTimeout(t(),200)}})}var n={products:[],colors:[],sizes:[],paymentMethods:[],billStatuses:[]};this.initialize=function(){$.when(o(),s(),h(),c()).then(function(){t()});e()}},BlogController=function(){function i(){$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtNameM:{required:!0},txtAliasM:{required:!0}}});$("#txt-search-keyword").keypress(function(t){t.which===13&&(t.preventDefault(),n())});$("#btn-search").on("click",function(){n()});$("#ddl-show-page").on("change",function(){structures.configs.pageSize=$(this).val();structures.configs.pageIndex=1;n(!0)});$("#btn-create").on("click",function(){t();$("#modal-add-edit").modal("show")});$("body").on("click",".btn-edit",function(n){n.preventDefault();var t=$(this).data("id");$.ajax({type:"GET",url:"/Admin/Blog/GetById",data:{id:t},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(n){var t=n;$("#hidIdM").val(t.Id);$("#txtNameM").val(t.Name);$("#txtAliasM").val(t.Alias);CKEDITOR.instances.txtContentM.setData(t.Content);$("#ckStatusM").prop("checked",t.Status===1);$("#modal-add-edit").modal("show");structures.stopLoading();$("#txtNameM").val(t.Name);$("#txtDescriptionM").val(t.Description);$("#txtImage").val(t.Image);$("#txtTagM").val(t.Tags);$("#txtMetakeywordM").val(t.SeoKeywords);$("#txtMetaDescriptionM").val(t.SeoDescription);$("#txtSeoPageTitleM").val(t.SeoPageTitle);$("#txtSeoAliasM").val(t.SeoAlias);$("#ckStatusM").prop("checked",t.Status===1);$("#ckHotM").prop("checked",t.HotFlag);$("#ckShowHomeM").prop("checked",t.HomeFlag);$("#modal-add-edit").modal("show");structures.stopLoading()},error:function(){structures.notify("Có lỗi xảy ra","error");structures.stopLoading()}})});$("#btnSaveM").on("click",function(i){if($("#frmMaintainance").valid()){i.preventDefault();var r=$("#hidIdM").val(),u=$("#txtNameM").val(),f=$("#txtMetakeywordM").val(),e=$("#txtMetaDescriptionM").val(),o=$("#txtSeoPageTitleM").val(),s=$("#txtSeoAliasM").val(),h=$("#txtTagM").val(),c=$("#txtImage").val(),l=$("#txtDescriptionM").val(),a=CKEDITOR.instances.txtContentM.getData(),v=$("#ckStatusM").prop("checked")===!0?1:0,y=$("#ckHotM").prop("checked"),p=$("#ckShowHomeM").prop("checked");return $.ajax({type:"POST",url:"/Admin/Blog/SaveEntity",data:{Id:r,Name:u,Image:c,Description:l,Content:a,HomeFlag:p,HotFlag:y,Tags:h,Status:v,SeoPageTitle:o,SeoAlias:s,SeoKeywords:f,SeoDescription:e},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Update page successful","success");$("#modal-add-edit").modal("hide");t();structures.stopLoading();n(!0)},error:function(){structures.notify("Have an error in progress","error");structures.stopLoading()}}),!1}return!1});$("body").on("click",".btn-delete",function(t){t.preventDefault();var i=$(this).data("id");structures.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Blog/Delete",data:{id:i},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Delete page successful","success");structures.stopLoading();n()},error:function(){structures.notify("Have an error in progress","error");structures.stopLoading()}})})});$("#btnSelectImg").on("click",function(){$("#fileInputImage").click()});$("#fileInputImage").on("change",function(){for(var r=$(this).get(0),t=r.files,i=new FormData,n=0;n<t.length;n++)i.append(t[n].name,t[n]);$.ajax({type:"POST",url:"/Admin/Upload/UploadImage",contentType:!1,processData:!1,data:i,success:function(n){$("#txtImage").val(n);structures.notify("Upload image succesful!","success")},error:function(){structures.notify("There was error uploading files!","error")}})})}function t(){$("#hidIdM").val(0);$("#txtNameM").val("");$("#txtAliasM").val("");CKEDITOR.instances.txtContentM.setData("");$("#txtDescriptionM").val("");$("#txtImage").val("");$("#txtTagM").val("");$("#txtMetakeywordM").val("");$("#txtMetaDescriptionM").val("");$("#txtSeoPageTitleM").val("");$("#txtSeoAliasM").val("");$("#ckStatusM").prop("checked",!0);$("#ckHotM").prop("checked",!1);$("#ckShowHomeM").prop("checked",!1)}function r(){CKEDITOR.replace("txtContentM",{filebrowserImageUploadUrl:"/Admin/Upload/UploadImageForCKEditor?type=Images"});$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(n){this.$element[0]===n.target||this.$element.has(n.target).length||$(n.target).closest(".cke_dialog, .cke").length||this.$element.trigger("focus")},this))}}function n(t){$.ajax({type:"GET",url:"/admin/Blog/GetAllPaging",data:{keyword:$("#txt-search-keyword").val(),page:structures.configs.pageIndex,pageSize:structures.configs.pageSize},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(i){var f=$("#table-template").html(),r="";i.RowCount>0?($.each(i.Results,function(n,t){r+=Mustache.render(f,{Name:t.Name,Alias:t.Alias,Id:t.Id,Status:structures.getStatus(t.Status)})}),$("#lbl-total-records").text(i.RowCount),r!==undefined&&$("#tbl-content").html(r),u(i.RowCount,function(){n()},t)):$("#tbl-content").html("");structures.stopLoading()},error:function(n){console.log(n)}})}function u(n,t,i){var r=Math.ceil(n/structures.configs.pageSize);($("#paginationUL a").length===0||i===!0)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page"));$("#paginationUL").twbsPagination({totalPages:r,visiblePages:7,first:"Đầu",prev:"Trước",next:"Tiếp",last:"Cuối",onPageClick:function(n,i){structures.configs.pageIndex=i;setTimeout(t(),200)}})}this.initialize=function(){n();i();r()}},conactController=function(){function i(){$("#ddl-show-page").on("change",function(){structures.configs.pageSize=$(this).val();structures.configs.pageIndex=1;n(!0)});$("#btnSearch").on("click",function(){n()});$("#txtKeyword").on("keypress",function(t){t.which===13&&n()});$("#btn-create").on("click",function(){t();$("#modal-add-edit").modal("show")});$("body").on("click",".btn-edit",function(n){n.preventDefault();var t=$(this).data("id");r(t)});$("#btnSave").on("click",function(n){f(n)});$("body").on("click",".btn-delete",function(n){n.preventDefault();var t=$(this).data("id");u(t)});$("#btnSelectImg").on("click",function(){$("#fileInputImage").click()});$("#fileInputImage").on("change",function(){for(var r=$(this).get(0),t=r.files,i=new FormData,n=0;n<t.length;n++)i.append(t[n].name,t[n]);$.ajax({type:"POST",url:"/Admin/Upload/UploadImageSlide",contentType:!1,processData:!1,data:i,success:function(n){$("#txtImage").val(n);structures.notify("Upload image succesful!","success")},error:function(){structures.notify("There was error uploading files!","error")}})})}function r(n){$.ajax({type:"GET",url:"/Admin/Contact/GetById",data:{id:n},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(n){var t=n;$("#hidId").val(t.Id);$("#txtName").val(t.Name);$("#txtPhone").val(t.Phone);$("#txtEmail").val(t.Email);$("#txtLat").val(t.Lat);$("#txtLng").val(t.Lng);$("#txtWebsite").val(t.Website);$("#txtAddress").val(t.Address);$("#ckStatusM").prop("checked",t.Status===1);$("#modal-add-edit").modal("show");structures.stopLoading()},error:function(){structures.notify("Có lỗi xảy ra","error");structures.stopLoading()}})}function u(t){structures.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Contact/Delete",data:{id:t},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Delete successful","success");structures.stopLoading();n()},error:function(){structures.notify("Has an error in delete progress","error");structures.stopLoading()}})})}function n(t){var r=$("#table-template").html(),i="";$.ajax({type:"GET",data:{keyword:$("#txtKeyword").val(),page:structures.configs.pageIndex,pageSize:structures.configs.pageSize},url:"/admin/Contact/GetAllPaging",dataType:"JSON",success:function(u){$.each(u.Results,function(n,t){i+=Mustache.render(r,{Id:t.Id,Name:t.Name,Phone:t.Phone,Email:t.Email,Lat:t.Lat,Lng:t.Lng})});$("#lblTotalRecords").text(u.RowCount);i!==""&&$("#tbl-content").html(i);o(u.RowCount,function(){n()},t)},error:function(n){console.log(n);structures.notify("Không thể tải dữ liệu","error")}})}function f(i){if($("#frmMaintainance").valid()){i.preventDefault();var r=$("#hidId").val(),u=$("#txtName").val(),f=$("#txtPhone").val(),e=$("#txtEmail").val(),o=$("#txtLat").val(),s=$("#txtLng").val(),h=$("#txtWebsite").val(),c=$("#txtAddress").val(),l=$("#ckStatus").prop("checked")===!0?1:0;return $.ajax({type:"POST",url:"/Admin/Contact/SaveEntity",data:{Id:r,Name:u,Phone:f,Email:e,Lat:o,Lng:s,Website:h,Address:c,Status:l},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Update product successful","success");$("#modal-add-edit").modal("hide");t();structures.stopLoading();n(!0)},error:function(){structures.notify("Có lổi trong quá trình thêm.","error");structures.stopLoading()}}),!1}}function t(){$("#hidId").val("");$("#txtName").val("");$("#txtImage").val("");$("#txtUrl").val("");$("#txtMetaDescription").val("");$("#txtPhone").val("");$("#txtEmail").val("");$("#txtLat").val("");$("#txtLng").val("");$("#txtWebsite").val("");$("#txtAddress").val("");$("#ckStatusM").prop("checked",!0)}function e(){CKEDITOR.replace("txtContent",{});$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(n){this.$element[0]===n.target||this.$element.has(n.target).length||$(n.target).closest(".cke_dialog, .cke").length||this.$element.trigger("focus")},this))}}function o(n,t,i){var r=Math.ceil(n/structures.configs.pageSize);($("#paginationUL a").length===0||i===!0)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page"));$("#paginationUL").twbsPagination({totalPages:r,visiblePages:7,first:"Đầu",prev:"Trước",next:"Tiếp",last:"Cuối",onPageClick:function(n,i){structures.configs.pageIndex=i;setTimeout(t(),200)}})}this.initialize=function(){n();i();e()}},HomeController=function(){function n(n,i){$.ajax({type:"GET",url:"/Admin/Home/GetRevenue",data:{fromDate:n,toDate:i},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(n){t(n);structures.stopLoading()},error:function(){structures.notify("Có lỗi xảy ra","error");structures.stopLoading()}})}function t(n){var t=[],i=[],r;$.each(n,function(n,i){t.push([new Date(i.Date).getTime(),i.Revenue])});$.each(n,function(n,t){i.push([new Date(t.Date).getTime(),t.Profit])});r={grid:{show:!0,aboveData:!0,color:"#3f3f3f",labelMargin:10,axisMargin:0,borderWidth:0,borderColor:null,minBorderMargin:5,clickable:!0,hoverable:!0,autoHighlight:!0,mouseActiveRadius:100},series:{lines:{show:!0,fill:!0,lineWidth:2,steps:!1},points:{show:!0,radius:4.5,symbol:"circle",lineWidth:3}},legend:{position:"ne",margin:[0,-25],noColumns:0,labelBoxBorderColor:null,labelFormatter:function(n){return n+"&nbsp;&nbsp;"},width:40,height:1},colors:["#96CA59","#3F97EB","#72c380","#6f7a8a","#f7cb38","#5a8022","#2c7282"],shadowSize:0,tooltip:!0,tooltipOpts:{content:"%s: %y.0",xDateFormat:"%d/%m",shifts:{x:-30,y:-50},defaultTheme:!1},yaxis:{min:0},xaxis:{mode:"time",minTickSize:[1,"day"],timeformat:"%d/%m/%y"}};$("#chart_plot_02").length&&(console.log("Plot2"),$.plot($("#chart_plot_02"),[{label:"Revenue",data:t,lines:{fillColor:"rgba(150, 202, 89, 0.12)"},points:{fillColor:"#fff"}},{label:"Profit",data:i,lines:{fillColor:"rgba(140, 232, 289, 0.12)"},points:{fillColor:"#fff"}}],r))}function i(){if(typeof $.fn.daterangepicker!="undefined"){console.log("init_daterangepicker");var t=function(n,t,i){console.log(n.toISOString(),t.toISOString(),i);$("#reportrange span").html(n.format("MMMM D, YYYY")+" - "+t.format("MMMM D, YYYY"))},i={startDate:moment().subtract(29,"days"),endDate:moment(),minDate:"01/01/2017",maxDate:moment().format("MM/DD/YYYY"),dateLimit:{days:60},showDropdowns:!0,showWeekNumbers:!0,timePicker:!1,timePickerIncrement:1,timePicker12Hour:!0,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},opens:"left",buttonClasses:["btn btn-default"],applyClass:"btn-small btn-primary",cancelClass:"btn-small",format:"MM/DD/YYYY",separator:" to ",locale:{applyLabel:"Submit",cancelLabel:"Clear",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1}};$("#reportrange span").html(moment().subtract(29,"days").format("MMMM D, YYYY")+" - "+moment().format("MMMM D, YYYY"));$("#reportrange").daterangepicker(i,t);$("#reportrange").on("show.daterangepicker",function(){console.log("show event fired")});$("#reportrange").on("hide.daterangepicker",function(){console.log("hide event fired")});$("#reportrange").on("apply.daterangepicker",function(t,i){console.log("apply event fired, start/end dates are "+i.startDate.format("MMMM D, YYYY")+" to "+i.endDate.format("MMMM D, YYYY"));n(i.startDate.format("MM/DD/YYYY"),i.endDate.format("MM/DD/YYYY"))});$("#reportrange").on("cancel.daterangepicker",function(){console.log("cancel event fired")});$("#options1").click(function(){$("#reportrange").data("daterangepicker").setOptions(i,t)});$("#options2").click(function(){$("#reportrange").data("daterangepicker").setOptions(optionSet2,t)});$("#destroy").click(function(){$("#reportrange").data("daterangepicker").remove()})}}this.initialize=function(){i();n()}},loginController=function(){this.initialize=function(){n()};var n=function(){$("#frmLogin").validate({rules:{userName:{required:!0,minlength:5},password:{required:!0,minlength:6}},messages:{userName:{required:"Bạn phải điền tên UserName",minlength:"Tên phải chứa hơn 6 ký tự"},password:{required:"Bạn phải điền tên Password",minlength:"Password phải chứa hơn 6 ký tự"}}});$("#btnLogin").on("click",function(n){if(n.preventDefault(),$("#frmLogin").valid()){var i=$("#txtUserName").val(),r=$("#txtPassword").val();t(i,r)}})},t=function(n,t){$.ajax({type:"POST",data:{Email:n,PassWord:t},dataType:"json",url:"/Admin/Login/Authen",success:function(n){n.Success?window.location.href="/Admin/Home/Index":structures.notify("Đăng nhập không đúng","error")}})}},PageController=function(){function i(){$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtNameM:{required:!0},txtAliasM:{required:!0}}});$("#txt-search-keyword").keypress(function(t){t.which===13&&(t.preventDefault(),n())});$("#btn-search").on("click",function(){n()});$("#ddl-show-page").on("change",function(){structures.configs.pageSize=$(this).val();structures.configs.pageIndex=1;n(!0)});$("#btn-create").on("click",function(){t();$("#modal-add-edit").modal("show")});$("body").on("click",".btn-edit",function(n){n.preventDefault();var t=$(this).data("id");$.ajax({type:"GET",url:"/Admin/Page/GetById",data:{id:t},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(n){var t=n;$("#hidIdM").val(t.Id);$("#txtNameM").val(t.Name);$("#txtAliasM").val(t.Alias);CKEDITOR.instances.txtContentM.setData(t.Content);$("#ckStatusM").prop("checked",t.Status===1);$("#modal-add-edit").modal("show");structures.stopLoading()},error:function(){structures.notify("Có lỗi xảy ra","error");structures.stopLoading()}})});$("#btnSaveM").on("click",function(i){if($("#frmMaintainance").valid()){i.preventDefault();var r=$("#hidIdM").val(),u=$("#txtNameM").val(),f=$("#Alias").val(),e=CKEDITOR.instances.txtContentM.getData(),o=$("#ckStatusM").prop("checked")===!0?1:0;return $.ajax({type:"POST",url:"/Admin/Page/SaveEntity",data:{Id:r,Name:u,Content:e,Status:o,Alias:f},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Update page successful","success");$("#modal-add-edit").modal("hide");t();structures.stopLoading();n(!0)},error:function(){structures.notify("Have an error in progress","error");structures.stopLoading()}}),!1}return!1});$("body").on("click",".btn-delete",function(t){t.preventDefault();var i=$(this).data("id");structures.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Page/Delete",data:{id:i},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Delete page successful","success");structures.stopLoading();n()},error:function(){structures.notify("Have an error in progress","error");structures.stopLoading()}})})})}function t(){$("#hidIdM").val(0);$("#txtNameM").val("");$("#txtAliasM").val("");CKEDITOR.instances.txtContentM.setData("");$("#ckStatusM").prop("checked",!0)}function r(){CKEDITOR.replace("txtContentM",{filebrowserImageUploadUrl:"/Admin/Upload/UploadImageForCKEditor?type=Images"});$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(n){this.$element[0]===n.target||this.$element.has(n.target).length||$(n.target).closest(".cke_dialog, .cke").length||this.$element.trigger("focus")},this))}}function n(t){$.ajax({type:"GET",url:"/admin/page/GetAllPaging",data:{keyword:$("#txt-search-keyword").val(),page:structures.configs.pageIndex,pageSize:structures.configs.pageSize},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(i){var f=$("#table-template").html(),r="";i.RowCount>0?($.each(i.Results,function(n,t){r+=Mustache.render(f,{Name:t.Name,Alias:t.Alias,Id:t.Id,Status:structures.getStatus(t.Status)})}),$("#lbl-total-records").text(i.RowCount),r!==undefined&&$("#tbl-content").html(r),u(i.RowCount,function(){n()},t)):$("#tbl-content").html("");structures.stopLoading()},error:function(n){console.log(n)}})}function u(n,t,i){var r=Math.ceil(n/structures.configs.pageSize);($("#paginationUL a").length===0||i===!0)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page"));$("#paginationUL").twbsPagination({totalPages:r,visiblePages:7,first:"Đầu",prev:"Trước",next:"Tiếp",last:"Cuối",onPageClick:function(n,i){structures.configs.pageIndex=i;setTimeout(t(),200)}})}this.initialize=function(){n();i();r()}},ImageManagement=function(){function i(){$("body").on("click",".btn-images",function(t){t.preventDefault();var i=$(this).data("id");$("#hidId").val(i);n($("#fileImage"));r();$("#modal-image-manage").modal("show")});$("body").on("click",".btn-delete-image",function(n){n.preventDefault();$(this).closest("div").remove()});$("#fileImage").on("change",function(){for(var u=$(this).get(0),i=u.files,r=new FormData,t=0;t<i.length;t++)r.append(i[t].name,i[t]);$.ajax({type:"POST",url:"/Admin/Upload/UploadImage",contentType:!1,processData:!1,data:r,success:function(t){n($("#fileImage"));$.each(t,function(n,t){$("#image-list").append('<div class="col-md-3"><img width="100"  data-path="'+t.FileName+'" src="'+t.FileName+'"><br/><a href="#" class="btn-delete-image">Xóa<\/a><\/div>')});structures.notify("Đã tải ảnh lên thành công!","success")},error:function(){structures.notify("There was error uploading files!","error")}})});$("#btnSaveImages").on("click",function(){var t=[];$.each($("#image-list").find("img"),function(){t.push($(this).data("path"))});$.ajax({url:"/admin/Product/SaveImages",data:{productId:$("#hidIdM").val(),images:t},type:"post",dataType:"json",success:function(){$("#modal-image-manage").modal("hide");$("#image-list").html("");n($("#fileImage"))}})})}function r(){$.ajax({url:"/admin/Product/GetImages",data:{productId:$("#hidIdM").val()},type:"get",dataType:"json",success:function(t){var i="";$.each(t,function(n,t){i+='<div class="col-md-3"><img width="100" src="'+t.Path+'" data-path="'+t.Path+'"><br/><a href="#" class="btn-delete-image">Xóa<\/a><\/div>'});$("#image-list").html(i);n($("#fileImage"))}})}function n(n){try{n.value=null}catch(t){throw t;}n.value&&n.parentNode.replaceChild(n.cloneNode(!0),n)}var u=this,t=t;this.initialize=function(){i()}},productController=function(){function e(){$("#ddlShowPage").on("change",function(){structures.configs.pageSize=$(this).val();structures.configs.pageIndex=1;n(!0)});$("#btnSearch").on("click",function(){n()});$("#txtKeyword").on("keypress",function(t){t.which===13&&n()});$("#btnCreate").on("click",function(){i();t();$("#modal-add-edit").modal("show")});$("#btnSelectImg").on("click",function(){$("#fileInputImage").click()});$("#fileInputImage").on("change",function(){var n;$("#linkImg").html("");var r=$(this).get(0),t=r.files,i=new FormData;for(n=0;n<t.length;n++)i.append(t[n].name,t[n]);$.ajax({type:"POST",url:"/Admin/Upload/UploadImage",contentType:!1,processData:!1,data:i,success:function(n){$.each(n,function(n,t){if(t.Status===!0){structures.notify("File đã tồn tại trong hệ thống","warning");$("#txtImage").val(t.FileName);$("#linkImg").append('<img class="imgR" width="200"  data-path="'+t.FileName+'" src="'+t.FileName+'">');return}$("#txtImage").val(t);$("#linkImg").append('<div class="imgR col-md-6"><img width="200"  data-path="'+t.FileName+'" src="'+t.FileName+'"><\/div>');structures.notify("Upload image succesful!","success")})},error:function(){structures.notify("There was error uploading files!","error")}})});$("body").on("click",".btn-edit",function(n){n.preventDefault();i();var t=$(this).data("id");o(t)});$("#btnSave").on("click",function(n){h(n)});$("body").on("click",".btn-delete",function(n){n.preventDefault();var t=$(this).data("id");c(t)});$("#btn-import").on("click",function(){t();$("#modal-import-excel").modal("show")});$("#btnImportExcel").on("click",function(){for(var u=$("#fileInputExcel").get(0),r=u.files,t=new FormData,i=0;i<r.length;i++)t.append("files",r[i]);return t.append("categoryId",$("#ddlCategoryIdImportExcel").combotree("getValue")),$.ajax({url:"/Admin/Product/ImportExcel",type:"POST",data:t,processData:!1,contentType:!1,success:function(){$("#modal-import-excel").modal("hide");n()}}),!1});$("#btn-export").on("click",function(){$.ajax({type:"POST",url:"/Admin/Product/ExportExcel",beforeSend:function(){structures.startLoading()},success:function(n){window.location.href=n;structures.stopLoading()},error:function(){structures.notify("Has an error in progress","error");structures.stopLoading()}})})}function o(n){$.ajax({type:"GET",url:"/Admin/Product/GetById",data:{id:n},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(n){var i=n;$("#hidIdM").val(i.Id);$("#txtNameM").val(i.Name);t(i.CategoryId);$("#txtDescM").val(i.Description);$("#txtUnitM").val(i.Unit);$("#txtPriceM").val(i.Price);$("#txtOriginalPriceM").val(i.OriginalPrice);$("#txtPromotionPriceM").val(i.PromotionPrice);$("#txtImage").val(i.Image);$("#txtTagM").val(i.Tags);$("#txtMetakeywordM").val(i.SeoKeywords);$("#txtMetaDescriptionM").val(i.SeoDescription);$("#txtSeoPageTitleM").val(i.SeoPageTitle);$("#txtSeoAliasM").val(i.SeoAlias);$("#txtProductStatus").val(i.ProductStatus);$("#txtTotal").val(i.Total);CKEDITOR.instances.txtContent.setData(i.Content);$("#ckStatusM").prop("checked",i.Status===1);$("#ckHotM").prop("checked",i.HotFlag);$("#ckShowHomeM").prop("checked",i.HomeFlag);$("#ckOldProduct").prop("checked",i.OldProduct);$("#isProductPlashSale").prop("checked",i.IsProductPlashSale);$("#modal-add-edit").modal("show");structures.stopLoading()},error:function(){structures.notify("Có lỗi xảy ra","error");structures.stopLoading()}})}function s(){$.ajax({type:"get",url:"/Admin/Product/GetAllCategory",dataType:"json",success:function(n){var t="<option value=''>--Select category--<\/option>";$.each(n,function(n,i){t+="<option value='"+i.Id+"'>"+i.Name+"<\/option>"});$("#ddlCategorySearch").html(t)},error:function(n){console.log(n);structures.notify("Không thể tải dữ liệu","error")}})}function h(t){if($("#frmMaintainance").valid()){t.preventDefault();var r=$("#hidIdM").val(),u=$("#txtNameM").val(),f=$("#ddlCategoryIdM").combotree("getValue"),e=$("#txtDescM").val(),o=$("#txtUnitM").val(),s=$("#txtPriceM").val(),h=$("#txtOriginalPriceM").val(),c=$("#txtPromotionPriceM").val(),l=$("#txtImage").val(),a=$("#txtTagM").val(),v=$("#txtMetakeywordM").val(),y=$("#txtMetaDescriptionM").val(),p=$("#txtSeoPageTitleM").val(),w=$("#txtSeoAliasM").val(),b=$("#txtProductStatus").val(),k=$("#txtTotal").val(),d=CKEDITOR.instances.txtContent.getData(),g=$("#ckStatusM").prop("checked")===!0?1:0,nt=$("#ckHotM").prop("checked"),tt=$("#ckShowHomeM").prop("checked"),it=$("#ckBuyALotM").prop("checked"),rt=$("#ckOldProduct").prop("checked"),ut=$("#isProductPlashSale").prop("checked");return $.ajax({type:"POST",url:"/Admin/Product/SaveEntity",data:{Id:r,Name:u,CategoryId:f,Image:l,Price:s,OriginalPrice:h,PromotionPrice:c,Description:e,Content:d,HomeFlag:tt,HotFlag:nt,BuyALot:it,OldProduct:rt,Tags:a,Unit:o,Status:g,SeoPageTitle:p,SeoAlias:w,SeoKeywords:v,SeoDescription:y,ProductStatus:b,IsProductPlashSale:ut,Total:k},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Update product successful","success");$("#modal-add-edit").modal("hide");i();structures.stopLoading();n(!0)},error:function(n){var t=n.responseJSON.Message;structures.notify(t,"error");structures.stopLoading()}}),!1}}function c(t){structures.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Product/Delete",data:{id:t},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Delete successful","success");structures.stopLoading();n()},error:function(){structures.notify("Has an error in delete progress","error");structures.stopLoading()}})})}function n(t){var r=$("#table-template").html(),i="";$.ajax({type:"GET",data:{categoryId:$("#ddlCategorySearch").val(),keyword:$("#txtKeyword").val(),page:structures.configs.pageIndex,pageSize:structures.configs.pageSize},url:"/admin/product/GetAllPaging",dataType:"JSON",success:function(u){$.each(u.Results,function(n,t){i+=Mustache.render(r,{Id:t.Id,Name:t.Name,Image:t.Image===null?'<img src="/admin-side/images/user.png" width=25':'<img src="'+t.Image+'" width=25 />',CategoryName:t.ProductCategory.Name,Price:structures.formatNumber(t.Price,0),CreatedDate:structures.dateTimeFormatJson(t.DateCreated),Status:structures.getStatus(t.Status)})});$("#lblTotalRecords").text(u.RowCount);i!==""&&$("#tbl-content").html(i);a(u.RowCount,function(){n()},t);structures.stopLoading()},error:function(n){console.log(n);structures.notify("Không thể tải dữ liệu","error")}})}function l(){CKEDITOR.replace("txtContent",{});$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(n){this.$element[0]===n.target||this.$element.has(n.target).length||$(n.target).closest(".cke_dialog, .cke").length||this.$element.trigger("focus")},this))}}function t(n){$.ajax({url:"/Admin/ProductCategory/GetAll",type:"GET",dataType:"json","async":!1,success:function(t){var r=[],i;$.each(t,function(n,t){r.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});i=structures.unflattern(r);$("#ddlCategoryIdM").combotree({data:i});$("#ddlCategoryIdImportExcel").combotree({data:i});n!==undefined&&$("#ddlCategoryIdM").combotree("setValue",n)}})}function i(){$("#hidIdM").val(0);$("#txtNameM").val("");t("");$("#txtDescM").val("");$("#txtUnitM").val("");$("#txtPriceM").val("0");$("#txtOriginalPriceM").val("");$("#txtPromotionPriceM").val("");$("#txtImage").val("");$("#txtTagM").val("");$("#txtMetakeywordM").val("");$("#txtMetaDescriptionM").val("");$("#txtSeoPageTitleM").val("");$("#txtSeoAliasM").val("");$("#productStatus").val("");$("#txtTotal").val("");$("#linkImg").html("");CKEDITOR.instances.txtContent.setData("");$("#ckStatusM").prop("checked",!0);$("#ckHotM").prop("checked",!1);$("#ckShowHomeM").prop("checked",!1);$("#ckOldProduct").prop("checked",!1);$("#isProductPlashSale").prop("checked",!1)}function a(n,t,i){var r=Math.ceil(n/structures.configs.pageSize);($("#paginationUL a").length===0||i===!0)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page"));$("#paginationUL").twbsPagination({totalPages:r,visiblePages:7,first:"Đầu",prev:"Trước",next:"Tiếp",last:"Cuối",onPageClick:function(n,i){structures.configs.pageIndex=i;setTimeout(t(),200)}})}var r=new QuantityManagement,u=new WholePriceManagement,f=new ImageManagement;this.initialize=function(){s();n();e();l();r.initialize();u.initialize();f.initialize()}},QuantityManagement=function(){function r(){$("body").on("click",".btn-quantity",function(n){n.preventDefault();var t=$(this).data("id");$("#hidId").val(t);u();$("#modal-quantity-management").modal("show")});$("body").on("click",".btn-delete-quantity",function(n){n.preventDefault();$(this).closest("tr").remove()});$("#btn-add-quantity").on("click",function(){var n=$("#template-table-quantity").html(),r=Mustache.render(n,{Id:0,Colors:t(null),Sizes:i(null),Quantity:0});$("#table-quantity-content").append(r)});$("#btnSaveQuantity").on("click",function(){var n=[];$.each($("#table-quantity-content").find("tr"),function(t,i){n.push({Id:$(i).data("id"),ProductId:$("#hidId").val(),Quantity:$(i).find("input.txtQuantity").first().val(),SizeId:$(i).find("select.ddlSizeId").first().val(),ColorId:$(i).find("select.ddlColorId").first().val()})});$.ajax({url:"/admin/Product/SaveQuantities",data:{productId:$("#hidId").val(),quantities:n},type:"post",dataType:"json",success:function(){structures.notify("Thêm số lượng thành công.!","success");$("#modal-quantity-management").modal("hide");$("#table-quantity-content").html("")}})})}function u(){$.ajax({url:"/admin/Product/GetQuantities",data:{productId:$("#hidId").val()},type:"get",dataType:"json",success:function(n){var r="",u=$("#template-table-quantity").html();$.each(n,function(n,f){r+=Mustache.render(u,{Id:f.Id,Colors:t(f.ColorId),Sizes:i(f.SizeId),Quantity:f.Quantity})});$("#table-quantity-content").html(r);resetFile()}})}function f(){return $.ajax({type:"GET",url:"/Admin/Bill/GetColors",dataType:"json",success:function(t){n.colors=t},error:function(){structures.notify("Có lỗi xảy ra","error")}})}function e(){return $.ajax({type:"GET",url:"/Admin/Bill/GetSizes",dataType:"json",success:function(t){n.sizes=t},error:function(){structures.notify("Có lỗi xảy ra","error")}})}function t(t){var i="<select class='form-control ddlColorId'>";return $.each(n.colors,function(n,r){i+=t===r.Id?'<option value="'+r.Id+'" selected="select">'+r.Name+"<\/option>":'<option value="'+r.Id+'">'+r.Name+"<\/option>"}),i+="<\/select>"}function i(t){var i="<select class='form-control ddlSizeId'>";return $.each(n.sizes,function(n,r){i+=t===r.Id?'<option value="'+r.Id+'" selected="select">'+r.Name+"<\/option>":'<option value="'+r.Id+'">'+r.Name+"<\/option>"}),i+="<\/select>"}var o=this,n={colors:[],sizes:[]};this.initialize=function(){f();e();r()}},WholePriceManagement=function(){function n(){$("body").on("click",".btn-whole-price",function(n){n.preventDefault();var i=$(this).data("id");$("#hidId").val(i);t();$("#modal-whole-price").modal("show")});$("body").on("click",".btn-delete-whole-price",function(n){n.preventDefault();$(this).closest("tr").remove()});$("#btn-add-whole-price").on("click",function(){var n=$("#template-table-whole-price").html(),t=Mustache.render(n,{Id:0,FromQuantity:0,ToQuantity:0,Price:0});$("#table-content-whole-price").append(t)});$("#btnSaveWholePrice").on("click",function(){var n=[];$.each($("#table-content-whole-price").find("tr"),function(t,i){n.push({Id:$(i).data("id"),ProductId:$("#hidId").val(),FromQuantity:$(i).find("input.txtQuantityFrom").first().val(),ToQuantity:$(i).find("input.txtQuantityTo").first().val(),Price:$(i).find("input.txtWholePrice").first().val()})});$.ajax({url:"/admin/Product/SaveWholePrice",data:{productId:$("#hidId").val(),wholePrices:n},type:"post",dataType:"json",success:function(){$("#modal-whole-price").modal("hide");$("#table-content-whole-price").html("")}})})}function t(){$.ajax({url:"/admin/Product/GetWholePrices",data:{productId:$("#hidId").val()},type:"get",dataType:"json",success:function(n){var t="",i=$("#template-table-whole-price").html();$.each(n,function(n,r){t+=Mustache.render(i,{Id:r.Id,FromQuantity:r.FromQuantity,ToQuantity:r.ToQuantity,Price:r.Price})});$("#table-content-whole-price").html(t)}})}var i=this;this.initialize=function(){n()}},productCategoryController=function(){function r(){$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtNameM:{required:!0},txtOrderM:{number:!0},txtHomeOrderM:{number:!0}}});$("#btnCreate").off("click").on("click",function(){t();$("#modal-add-edit").modal("show")});$("#btnSelectImg").on("click",function(){$("#fileInputImage").click()});$("#fileInputImage").on("change",function(){for(var r=$(this).get(0),t=r.files,i=new FormData,n=0;n<t.length;n++)i.append(t[n].name,t[n]);$.ajax({type:"POST",url:"/Admin/Upload/UploadImage",contentType:!1,processData:!1,data:i,success:function(n){$("#txtImage").val(n);structures.notify("Upload image succesful!","success")},error:function(){structures.notify("There was error uploading files!","error")}})});$("#modal-add-edit").on("hidden.bs.modal",function(){i()});$("body").on("click","#btnEdit",function(n){n.preventDefault();var i=$("#hidIdM").val();$.ajax({type:"GET",url:"/Admin/ProductCategory/GetById",data:{id:i},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(n){var i=n;$("#hidIdM").val(i.Id);$("#txtNameM").val(i.Name);t(i.ParentId);$("#txtDescM").val(i.Description);$("#txtImage").val(i.Image);$("#txtSeoKeywordM").val(i.SeoKeywords);$("#txtSeoDescriptionM").val(i.SeoDescription);$("#txtSeoPageTitleM").val(i.SeoPageTitle);$("#txtSeoAliasM").val(i.SeoAlias);$("#ckStatusM").prop("checked",i.Status===1);$("#ckShowHomeM").prop("checked",i.HomeFlag);$("#txtOrderM").val(i.SortOrder);$("#txtHomeOrderM").val(i.HomeOrder);$("#modal-add-edit").modal("show");structures.stopLoading()},error:function(){structures.notify("Có lỗi xảy ra","error");structures.stopLoading()}})});$("body").on("click","#btnDelete",function(t){t.preventDefault();var i=$("#hidIdM").val();structures.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/ProductCategory/Delete",data:{id:i},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Deleted success","success");structures.stopLoading();n()},error:function(){structures.notify("Has an error in deleting progress","error");structures.stopLoading()}})})});$("#btnSave").on("click",function(t){if($("#frmMaintainance").valid()){t.preventDefault();var r=parseInt($("#hidIdM").val()),u=$("#txtNameM").val(),f=$("#ddlCategoryIdM").combotree("getValue"),e=$("#txtDescM").val(),o=$("#txtImage").val(),s=parseInt($("#txtOrderM").val()),h=$("#txtHomeOrderM").val(),c=$("#txtSeoKeywordM").val(),l=$("#txtSeoDescriptionM").val(),a=$("#txtSeoPageTitleM").val(),v=$("#txtSeoAliasM").val(),y=$("#ckStatusM").prop("checked")===!0?1:0,p=$("#ckShowHomeM").prop("checked");$.ajax({type:"POST",url:"/Admin/ProductCategory/SaveEntity",data:{Id:r,Name:u,Description:e,ParentId:f,HomeOrder:h,SortOrder:s,HomeFlag:p,Image:o,Status:y,SeoPageTitle:a,SeoAlias:v,SeoKeywords:c,SeoDescription:l},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Update success","success");$("#modal-add-edit").modal("hide");i();structures.stopLoading();n(!0)},error:function(n){var t=n.responseJSON.Message;structures.notify(t,"error");structures.stopLoading()}})}return!1})}function i(){$("#hidIdM").val(0);$("#txtNameM").val("");t("");$("#txtDescM").val("");$("#txtOrderM").val("");$("#txtHomeOrderM").val("");$("#txtImageM").val("");$("#txtMetakeywordM").val("");$("#txtMetaDescriptionM").val("");$("#txtSeoPageTitleM").val("");$("#txtSeoAliasM").val("");$("#ckStatusM").prop("checked",!0);$("#ckShowHomeM").prop("checked",!1)}function t(n){$.ajax({url:"/Admin/ProductCategory/GetAll",type:"GET",dataType:"json","async":!1,success:function(t){var i=[],r;$.each(t,function(n,t){i.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});r=structures.unflattern(i);$("#ddlCategoryIdM").combotree({data:r});n!==undefined&&$("#ddlCategoryIdM").combotree("setValue",n)}})}function n(){$.ajax({url:"/Admin/ProductCategory/GetAll",dataType:"json",success:function(t){var r=[],i;$.each(t,function(n,t){r.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});i=structures.unflattern(r);i.sort(function(n,t){return n.sortOrder-t.sortOrder});$("#treeProductCategory").tree({data:i,dnd:!0,onContextMenu:function(n,t){n.preventDefault();$("#hidIdM").val(t.id);$("#contextMenu").menu("show",{left:n.pageX,top:n.pageY})},onDrop:function(t,i,r){var u,f;console.log(t);console.log(i);console.log(r);u=$(this).tree("getNode",t);r==="append"?(f=[],$.each(u.children,function(n,t){f.push({key:t.id,value:n})}),$.ajax({url:"/Admin/ProductCategory/UpdateParentId",type:"post",dataType:"json",data:{sourceId:i.id,targetId:u.id,items:f},success:function(){n()}})):(r==="top"||r==="bottom")&&$.ajax({url:"/Admin/ProductCategory/ReOrder",type:"post",dataType:"json",data:{sourceId:i.id,targetId:u.id},success:function(){n()}})}})}})}this.initialize=function(){n();r()}},RoleController=function(){function i(){$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"vi",rules:{txtName:{required:!0}}});$("#txt-search-keyword").keypress(function(t){t.which===13&&(t.preventDefault(),n())});$("#btn-search").on("click",function(){n()});$("#ddl-show-page").on("change",function(){structures.configs.pageSize=$(this).val();structures.configs.pageIndex=1;n(!0)});$("#btn-create").on("click",function(){t();$("#modal-add-edit").modal("show")});$("body").on("click",".btn-grant",function(){$("#hidRoleId").val($(this).data("id"));$.when(r()).done(u($("#hidRoleId").val()));$("#modal-grantpermission").modal("show")});$("body").on("click",".btn-edit",function(n){n.preventDefault();var t=$(this).data("id");$.ajax({type:"GET",url:"/Admin/Role/GetById",data:{id:t},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(n){var t=n;$("#hidId").val(t.Id);$("#txtName").val(t.Name);$("#txtDescription").val(t.Description);$("#modal-add-edit").modal("show");structures.stopLoading()},error:function(){structures.notify("Có lỗi xảy ra","error");structures.stopLoading()}})});$("#btnSave").on("click",function(i){if($("#frmMaintainance").valid()){i.preventDefault();var r=$("#hidId").val(),u=$("#txtName").val(),f=$("#txtDescription").val();return $.ajax({type:"POST",url:"/Admin/Role/SaveEntity",data:{Id:r,Name:u,Description:f},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Update role successful","success");$("#modal-add-edit").modal("hide");t();structures.stopLoading();n(!0)},error:function(){structures.notify("Has an error","error");structures.stopLoading()}}),!1}});$("body").on("click",".btn-delete",function(t){t.preventDefault();var i=$(this).data("id");structures.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Role/Delete",data:{id:i},beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Delete successful","success");structures.stopLoading();n()},error:function(){structures.notify("Has an error in deleting progress","error");structures.stopLoading()}})})});$("#btnSavePermission").off("click").on("click",function(){var n=[];$.each($("#tblFunction tbody tr"),function(t,i){n.push({RoleId:$("#hidRoleId").val(),FunctionId:$(i).data("id"),CanRead:$(i).find(".ckView").first().prop("checked"),CanCreate:$(i).find(".ckAdd").first().prop("checked"),CanUpdate:$(i).find(".ckEdit").first().prop("checked"),CanDelete:$(i).find(".ckDelete").first().prop("checked")})});$.ajax({type:"POST",url:"/admin/role/SavePermission",data:{listPermmission:n,roleId:$("#hidRoleId").val()},beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Save permission successful","success");$("#modal-grantpermission").modal("hide");structures.stopLoading()},error:function(){structures.notify("Has an error in save permission progress","error");structures.stopLoading()}})})}function r(n){return $.ajax({type:"GET",url:"/admin/Function/GetAll",dataType:"json",beforeSend:function(){structures.startLoading()},success:function(t){var r=$("#result-data-function").html(),i="";$.each(t,function(n,t){i+=Mustache.render(r,{Name:t.Name,treegridparent:t.ParentId!==null?"treegrid-parent-"+t.ParentId:"",Id:t.Id,AllowCreate:t.AllowCreate?"checked":"",AllowEdit:t.AllowEdit?"checked":"",AllowView:t.AllowView?"checked":"",AllowDelete:t.AllowDelete?"checked":"",Status:structures.getStatus(t.Status)})});i!==undefined&&$("#lst-data-function").html(i);$(".tree").treegrid();$("#ckCheckAllView").on("click",function(){$(".ckView").prop("checked",$(this).prop("checked"))});$("#ckCheckAllCreate").on("click",function(){$(".ckAdd").prop("checked",$(this).prop("checked"))});$("#ckCheckAllEdit").on("click",function(){$(".ckEdit").prop("checked",$(this).prop("checked"))});$("#ckCheckAllDelete").on("click",function(){$(".ckDelete").prop("checked",$(this).prop("checked"))});$(".ckView").on("click",function(){$(".ckView:checked").length===t.length?$("#ckCheckAllView").prop("checked",!0):$("#ckCheckAllView").prop("checked",!1)});$(".ckAdd").on("click",function(){$(".ckAdd:checked").length===t.length?$("#ckCheckAllCreate").prop("checked",!0):$("#ckCheckAllCreate").prop("checked",!1)});$(".ckEdit").on("click",function(){$(".ckEdit:checked").length===t.length?$("#ckCheckAllEdit").prop("checked",!0):$("#ckCheckAllEdit").prop("checked",!1)});$(".ckDelete").on("click",function(){$(".ckDelete:checked").length===t.length?$("#ckCheckAllDelete").prop("checked",!0):$("#ckCheckAllDelete").prop("checked",!1)});n!==undefined&&n();structures.stopLoading()},error:function(n){console.log(n)}})}function u(n){return $.ajax({type:"POST",url:"/Admin/Role/ListAllFunction",data:{roleId:n},dataType:"json",beforeSend:function(){structures.stopLoading()},success:function(n){var t=n;$.each($("#tblFunction tbody tr"),function(n,i){$.each(t,function(n,t){t.FunctionId===$(i).data("id")&&($(i).find(".ckView").first().prop("checked",t.CanRead),$(i).find(".ckAdd").first().prop("checked",t.CanCreate),$(i).find(".ckEdit").first().prop("checked",t.CanUpdate),$(i).find(".ckDelete").first().prop("checked",t.CanDelete))})});$(".ckView:checked").length===$("#tblFunction tbody tr .ckView").length?$("#ckCheckAllView").prop("checked",!0):$("#ckCheckAllView").prop("checked",!1);$(".ckAdd:checked").length===$("#tblFunction tbody tr .ckAdd").length?$("#ckCheckAllCreate").prop("checked",!0):$("#ckCheckAllCreate").prop("checked",!1);$(".ckEdit:checked").length===$("#tblFunction tbody tr .ckEdit").length?$("#ckCheckAllEdit").prop("checked",!0):$("#ckCheckAllEdit").prop("checked",!1);$(".ckDelete:checked").length===$("#tblFunction tbody tr .ckDelete").length?$("#ckCheckAllDelete").prop("checked",!0):$("#ckCheckAllDelete").prop("checked",!1);structures.stopLoading()},error:function(n){console.log(n)}})}function t(){$("#hidId").val("");$("#txtName").val("");$("#txtDescription").val("")}function n(t){$.ajax({type:"GET",url:"/admin/role/GetAllPaging",data:{keyword:$("#txt-search-keyword").val(),page:structures.configs.pageIndex,pageSize:structures.configs.pageSize},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(i){var u=$("#table-template").html(),r="";i.RowCount>0?($.each(i.Results,function(n,t){r+=Mustache.render(u,{Name:t.Name,Id:t.Id,Description:t.Description})}),$("#lbl-total-records").text(i.RowCount),r!==undefined&&$("#tbl-content").html(r),f(i.RowCount,function(){n()},t)):$("#tbl-content").html("");structures.stopLoading()},error:function(n){console.log(n)}})}function f(n,t,i){var r=Math.ceil(n/structures.configs.pageSize);($("#paginationUL a").length===0||i===!0)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page"));$("#paginationUL").twbsPagination({totalPages:r,visiblePages:7,first:"Đầu",prev:"Trước",next:"Tiếp",last:"Cuối",onPageClick:function(n,i){structures.configs.pageIndex=i;setTimeout(t(),200)}})}var e=this;this.initialize=function(){n();i()}},settingController=function(){function n(){$("#ddl-show-page").on("change",function(){structures.configs.pageSize=$(this).val();structures.configs.pageIndex=1;loadData(!0)});$("#btnSave").on("click",function(n){i(n)});$("#btnSelectImg").on("click",function(){$("#fileInputImage").click()});$("#fileInputImage").on("change",function(){for(var r=$(this).get(0),t=r.files,i=new FormData,n=0;n<t.length;n++)i.append(t[n].name,t[n]);$.ajax({type:"POST",url:"/Admin/Upload/UploadLogo",contentType:!1,processData:!1,data:i,success:function(n){$("#txtImage").val(n);structures.notify("Upload image succesful!","success")},error:function(){structures.notify("There was error uploading files!","error")}})})}function t(){$.ajax({type:"GET",url:"/Admin/Setting/GetById",data:{},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(n){var t=n;$("#hidId").val(t.Id);$("#txtTitle").val(t.Title);$("#txtDesc").val(t.Description);$("#txtKeywords").val(t.Keywords);$("#txtCopyright").val(t.Copyright);$("#txtAuthor").val(t.Author);$("#txtImage").val(t.Logo);structures.stopLoading()},error:function(){structures.notify("Có lỗi xảy ra","error");structures.stopLoading()}})}function i(n){if($("#frmMaintainance").valid())return n.preventDefault(),id=$("#hidId").val(),title=$("#txtTitle").val(),keywords=$("#txtDesc").val(),description=$("#txtKeywords").val(),copyright=$("#txtCopyright").val(),author=$("#txtAuthor").val(),logo=$("#txtImage").val(),$.ajax({type:"POST",url:"/Admin/Setting/SaveEntity",data:{Id:id,Title:title,Keywords:keywords,Description:description,Copyright:copyright,Author:author,Logo:logo},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Thêm thành công","success");structures.stopLoading();loadData(!0)},error:function(){structures.notify("Có lổi trong quá trình thêm.","error");structures.stopLoading()}}),!1}function r(){CKEDITOR.replace("txtContent",{});$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(n){this.$element[0]===n.target||this.$element.has(n.target).length||$(n.target).closest(".cke_dialog, .cke").length||this.$element.trigger("focus")},this))}}this.initialize=function(){t();n();r()}},slideShowController=function(){function i(){$("#ddl-show-page").on("change",function(){structures.configs.pageSize=$(this).val();structures.configs.pageIndex=1;n(!0)});$("#btnSearch").on("click",function(){n()});$("#txtKeyword").on("keypress",function(t){t.which===13&&n()});$("#btn-create").on("click",function(){t();$("#modal-add-edit").modal("show")});$("body").on("click",".btn-edit",function(n){n.preventDefault();var t=$(this).data("id");r(t)});$("#btnSave").on("click",function(n){f(n)});$("body").on("click",".btn-delete",function(n){n.preventDefault();var t=$(this).data("id");u(t)});$("#btnSelectImg").on("click",function(){$("#fileInputImage").click()});$("#fileInputImage").on("change",function(){for(var r=$(this).get(0),t=r.files,i=new FormData,n=0;n<t.length;n++)i.append(t[n].name,t[n]);$.ajax({type:"POST",url:"/Admin/Upload/UploadImageSlide",contentType:!1,processData:!1,data:i,success:function(n){$("#txtImage").val(n);structures.notify("Upload image succesful!","success")},error:function(){structures.notify("There was error uploading files!","error")}})})}function r(n){$.ajax({type:"GET",url:"/Admin/SlideShow/GetById",data:{id:n},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(n){var t=n;$("#hidId").val(t.Id);$("#txtName").val(t.Name);$("#txtDesc").val(t.Description);$("#txtImage").val(t.Image);$("#txtUrl").val(t.Url);$("#txtGroupAlias").val(t.GroupAlias);CKEDITOR.instances.txtContent.getData(t.Content);$("#ckStatus").prop("checked",t.Status===1);$("#modal-add-edit").modal("show");structures.stopLoading()},error:function(){structures.notify("Có lỗi xảy ra","error");structures.stopLoading()}})}function u(t){structures.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/SlideShow/Delete",data:{id:t},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Delete successful","success");structures.stopLoading();n()},error:function(){structures.notify("Has an error in delete progress","error");structures.stopLoading()}})})}function n(t){var r=$("#table-template").html(),i="";$.ajax({type:"GET",data:{keyword:$("#txtKeyword").val(),page:structures.configs.pageIndex,pageSize:structures.configs.pageSize},url:"/admin/SlideShow/GetAllPaging",dataType:"JSON",success:function(u){$.each(u.Results,function(n,t){i+=Mustache.render(r,{Id:t.Id,Name:t.Name,Image:t.Image===null?'<img src="/admin-side/images/user.png" width=25':'<img src="'+t.Image+'" width=25 />',Description:t.Description,GroupAlias:t.GroupAlias,Status:structures.getStatus(t.Status)})});$("#lblTotalRecords").text(u.RowCount);i!==""&&$("#tbl-content").html(i);o(u.RowCount,function(){n()},t)},error:function(n){console.log(n);structures.notify("Không thể tải dữ liệu","error")}})}function f(i){if($("#frmMaintainance").valid()){i.preventDefault();var r=$("#hidId").val(),u=$("#txtName").val(),f=$("#txtDesc").val(),e=$("#txtImage").val(),o=$("#txtUrl").val(),s=$("#txtGroupAlias").val(),h=CKEDITOR.instances.txtContent.getData(),c=$("#ckStatus").prop("checked")===!0?1:0;return $.ajax({type:"POST",url:"/Admin/SlideShow/SaveEntity",data:{Id:r,Name:u,Image:e,Description:f,Content:h,GroupAlias:s,Status:c,Url:o},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Update product successful","success");$("#modal-add-edit").modal("hide");t();structures.stopLoading();n(!0)},error:function(){structures.notify("Có lổi trong quá trình thêm.","error");structures.stopLoading()}}),!1}}function t(){$("#hidId").val(0);$("#txtName").val("");$("#txtImage").val("");$("#txtUrl").val("");$("#txtMetaDescription").val("");$("#ckStatusM").prop("checked",!0)}function e(){CKEDITOR.replace("txtContent",{});$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(n){this.$element[0]===n.target||this.$element.has(n.target).length||$(n.target).closest(".cke_dialog, .cke").length||this.$element.trigger("focus")},this))}}function o(n,t,i){var r=Math.ceil(n/structures.configs.pageSize);($("#paginationUL a").length===0||i===!0)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page"));$("#paginationUL").twbsPagination({totalPages:r,visiblePages:7,first:"Đầu",prev:"Trước",next:"Tiếp",last:"Cuối",onPageClick:function(n,i){structures.configs.pageIndex=i;setTimeout(t(),200)}})}this.initialize=function(){n();i();e()}},UserController=function(){function u(){$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtFullName:{required:!0},txtUserName:{required:!0},txtPassword:{required:!0,minlength:6},txtConfirmPassword:{equalTo:"#txtPassword"},txtEmail:{required:!0,email:!0}},messages:{txtConfirmPassword:{required:"Bạn phải điền tên pass",equalTo:"pass không khớp với nhau"}}});$("#frmMaintainanceChangePass").validate({errorClass:"red",ignore:[],lang:"en",rules:{txtPasswordChange:{required:!0,minlength:6},txtConfirmPasswordChange:{equalTo:"#txtConfirmPasswordChange"}},messages:{txtConfirmPassword:{required:"Bạn phải điền mật khẩu.",equalTo:"Mật khẩu không khớp với nhau vui lòng điền lại."}}});$("#txt-search-keyword").keypress(function(t){t.which===13&&(t.preventDefault(),n())});$("#btn-search").on("click",function(){n()});$("#ddl-show-page").on("change",function(){structures.configs.pageSize=$(this).val();structures.configs.pageIndex=1;n(!0)});$("#btn-create").on("click",function(){i();r();$("#modal-add-edit").modal("show")});$("body").on("click",".btn-edit-pass",function(n){n.preventDefault();t(!1);var i=$(this).data("id");$.ajax({type:"GET",url:"/Admin/User/GetById",data:{id:i},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(n){var i=n;$("#hidId").val(i.Id);$("#FullName").val(i.FullName);t(!0);$("#modal-edit-pass").modal("show");structures.stopLoading()},error:function(){structures.notify("Có lỗi xảy ra","error");structures.stopLoading()}})});$("#btnSave-pass").on("click",function(t){if($("#frmMaintainanceChangePass").valid()){t.preventDefault();var r=$("#hidId").val(),u=$("#txtPasswordChange").val(),f=$("#txtConfirmPasswordChange").val();$.ajax({type:"POST",url:"/Admin/User/changepassword",data:{Id:r,Password:u,passWordConfirm:f},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(t){t!==!1?(structures.notify("Save user succesful","success"),$("#modal-edit-pass").modal("hide"),i(),structures.stopLoading(),n(!0)):(structures.notify("Có lổi khi thay dổi mật khẩu","error"),structures.stopLoading())},error:function(n){var t=n.responseJSON.Message;structures.notify(t,"error");structures.stopLoading()}})}return i(),!1});$("body").on("click",".btn-edit",function(n){n.preventDefault();var i=$(this).data("id");$.ajax({type:"GET",url:"/Admin/User/GetById",data:{id:i},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(n){var i=n;$("#hidId").val(i.Id);$("#txtFullName").val(i.FullName);$("#txtUserName").val(i.UserName);$("#txtEmail").val(i.Email);$("#txtPhoneNumber").val(i.PhoneNumber);$("#ckStatus").prop("checked",i.Status===1);r(i.Roles);t(!0);$("#modal-add-edit").modal("show");structures.stopLoading()},error:function(){structures.notify("Có lỗi xảy ra","error");structures.stopLoading()}})});$("#btnSave").on("click",function(t){var u;if($("#frmMaintainance").valid()){t.preventDefault();var f=$("#hidId").val(),e=$("#txtFullName").val(),o=$("#txtUserName").val(),s=$("#txtPassword").val(),h=$("#txtEmail").val(),c=$("#txtPhoneNumber").val(),r=[];$.each($('input[name="ckRoles"]'),function(n,t){$(t).prop("checked")===!0&&r.push($(t).prop("value"))});u=$("#ckStatus").prop("checked")===!0?1:0;$.ajax({type:"POST",url:"/Admin/User/SaveEntity",data:{Id:f,FullName:e,UserName:o,Password:s,Email:h,PhoneNumber:c,Status:u,Roles:r},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(t){t!==!1?(structures.notify("Save user succesful","success"),$("#modal-add-edit").modal("hide"),i(),structures.stopLoading(),n(!0)):(structures.notify("Email hoặc tài khoản đã tồn tại","error"),structures.stopLoading())}})}return!1});$("body").on("click",".btn-delete",function(t){t.preventDefault();var i=$(this).data("id");structures.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/User/Delete",data:{id:i},beforeSend:function(){structures.startLoading()},success:function(){structures.notify("Delete successful","success");structures.stopLoading();n()},error:function(){structures.notify("Has an error","error");structures.stopLoading()}})})})}function t(n){$("#txtUserName").prop("disabled",n);$("#txtPassword").prop("disabled",n);$("#txtConfirmPassword").prop("disabled",n)}function i(){t(!1);$("#hidId").val("");r();$("#txtFullName").val("");$("#txtUserName").val("");$("#txtPassword").val("");$("#txtConfirmPassword").val("");$('input[name="ckRoles"]').removeAttr("checked");$("#txtEmail").val("");$("#txtPhoneNumber").val("");$("#ckStatus").prop("checked",!0);$("#txtConfirmPasswordChange").val("");$("#txtPasswordChange").val("")}function r(n){$.ajax({url:"/Admin/Role/GetAll",type:"GET",dataType:"json","async":!1,success:function(t){var r=$("#role-template").html(),u=t,i="";$.each(u,function(t,u){var f="";n!==undefined&&n.indexOf(u.Name)!==-1&&(f="checked");i+=Mustache.render(r,{Name:u.Name,Description:u.Description,Checked:f})});$("#list-roles").html(i)}})}function n(t){$.ajax({type:"GET",url:"/admin/user/GetAllPaging",data:{categoryId:$("#ddl-category-search").val(),keyword:$("#txt-search-keyword").val(),page:structures.configs.pageIndex,pageSize:structures.configs.pageSize},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(i){var u=$("#table-template").html(),r="";i.RowCount>0?($.each(i.Results,function(n,t){r+=Mustache.render(u,{FullName:t.FullName,Id:t.Id,UserName:t.UserName,Avatar:t.Avatar===undefined?'<img src="/admin-side/images/user.png" width=25 />':'<img src="'+t.Avatar+'" width=25 />',DateCreated:structures.dateTimeFormatJson(t.DateCreated),Status:structures.getStatus(t.Status)})}),$("#lbl-total-records").text(i.RowCount),r!==undefined&&$("#tbl-content").html(r),f(i.RowCount,function(){n()},t)):$("#tbl-content").html("");structures.stopLoading()},error:function(n){console.log(n)}})}function f(n,t,i){var r=Math.ceil(n/structures.configs.pageSize);($("#paginationUL a").length===0||i===!0)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page"));$("#paginationUL").twbsPagination({totalPages:r,visiblePages:7,first:"Đầu",prev:"Trước",next:"Tiếp",last:"Cuối",onPageClick:function(n,i){structures.configs.pageIndex=i;setTimeout(t(),200)}})}this.initialize=function(){n();u()}},BaseController=function(){function n(){$("body").on("click",".btn-edit",function(n){n.preventDefault();var t=$(this).data("id");$.ajax({type:"GET",url:"/Admin/Role/GetById",data:{id:t},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(n){var t=n;$("#hidId").val(t.Id);$("#txtName").val(t.Name);$("#txtDescription").val(t.Description);$("#modal-add-edit").modal("show");structures.stopLoading()},error:function(){structures.notify("Có lỗi xảy ra","error");structures.stopLoading()}})})}function t(){$.ajax({type:"GET",url:"/admin/announcement/GetAllPaging",data:{page:structures.configs.pageIndex,pageSize:structures.configs.pageSize},dataType:"json",beforeSend:function(){structures.startLoading()},success:function(n){var i=$("#announcement-template").html(),t="";n.RowCount>0?($("#announcementArea").show(),$.each(n.Results,function(n,r){t+=Mustache.render(i,{Content:r.Content,Id:r.Id,Title:r.Title,FullName:r.FullName,Avatar:r.Avatar})}),t+=$("#announcement-tag-template").html(),$("#totalAnnouncement").text(n.RowCount),t!==undefined&&$("#annoncementList").html(t)):($("#badge_number_notifi").hide(),$("#annoncementList").html(""));structures.stopLoading()},error:function(n){console.log(n)}})}this.initialize=function(){t();n()}},connection=(new signalR.HubConnectionBuilder).withUrl("/signalRHub").configureLogging(signalR.LogLevel.Information).build(),structures;connection.start().catch(n=>console.error(n.toString()));connection.on("ReceiveMessage",n=>{var i,r,t,u;i=$("#announcement-template").html();r=Mustache.render(i,{Content:n.content,Id:n.id,Title:n.title,FullName:n.fullName,Avatar:n.avatar});$("#annoncementList").prepend(r);$("#badge_number_notifi").show();t=$("#totalAnnouncement").text();(t===null||t==="")&&(t=0);u=parseInt(t)+1;$("#totalAnnouncement").text(u)});structures={configs:{pageSize:12,pageIndex:1},notify:function(n,t){$.notify(n,{clickToHide:!0,autoHide:!0,autoHideDelay:5e3,arrowShow:!0,arrowSize:5,position:"...",elementPosition:"top left",globalPosition:"top right",style:"bootstrap",className:t,showAnimation:"slideDown",showDuration:400,hideAnimation:"slideUp",hideDuration:200,gap:2})},confirm:function(n,t){bootbox.confirm({message:n,buttons:{confirm:{label:"Đồng ý",className:"btn-success"},cancel:{label:"Huỷ",className:"btn-danger"}},callback:function(n){n===!0&&t()}})},dateFormatJson:function(n){if(n===null||n==="")return"";var t=new Date(parseInt(n.substr(6))),i=t.getMonth()+1,r=t.getDate(),e=t.getFullYear(),u=t.getHours(),f=t.getMinutes();return i<10&&(i="0"+i),r<10&&(r="0"+r),u<10&&(u="0"+u),f<10&&(f="0"+f),r+"/"+i+"/"+e},dateTimeFormatJson:function(n){if(n!==null||n!==""){var t=new Date(n),i=t.getMonth()+1,r=t.getDate(),o=t.getFullYear(),u=t.getHours(),f=t.getMinutes(),e=t.getSeconds();return i<10&&(i="0"+i),r<10&&(r="0"+r),u<10&&(u="0"+u),f<10&&(f="0"+f),e<10&&(e="0"+e),r+"/"+i+"/"+o+" "+u+":"+f+":"+e}var t=new Date(parseInt(n.substr(6))),i=t.getMonth()+1,r=t.getDate(),o=t.getFullYear(),u=t.getHours(),f=t.getMinutes(),e=t.getSeconds();return i<10&&(i="0"+i),r<10&&(r="0"+r),u<10&&(u="0"+u),f<10&&(f="0"+f),e<10&&(e="0"+e),r+"/"+i+"/"+o+" "+u+":"+f+":"+e},startLoading:function(){$(".dv-loading").length>0&&$(".dv-loading").removeClass("hide")},stopLoading:function(){$(".dv-loading").length>0&&$(".dv-loading").addClass("hide")},getStatus:function(n){return n===1?'<span class="badge bg-green">Kích hoạt<\/span>':'<span class="badge bg-red">Khoá<\/span>'},formatNumber:function(n,t){if(!isFinite(n))return n.toString();var i=n.toFixed(t).split(".");return i[0]=i[0].replace(/\d(?=(\d{3})+$)/g,"$&,"),i.join(".")},unflattern:function(n){for(var t,r={},u=[],i=0;i<n.length;i+=1)t=n[i],t.children=[],r[t.id]=i,t.parentId!==null?n[r[t.parentId]].children.push(t):u.push(t);return u}};$(document).ajaxSend(function(n,t,i){if(i.type.toUpperCase()==="POST"||i.type.toUpperCase()==="PUT"){var r=$("form").find("input[name='__RequestVerificationToken']").val();t.setRequestHeader("RequestVerificationToken",r)}});