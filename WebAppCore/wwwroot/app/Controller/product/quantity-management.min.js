var QuantityManagement = function () { var t = { colors: [], sizes: [] }; function e(e) { var n = "<select class='form-control ddlColorId'>"; return $.each(t.colors, function (t, a) { e === a.Id ? n += '<option value="' + a.Id + '" selected="select">' + a.Name + "</option>" : n += '<option value="' + a.Id + '">' + a.Name + "</option>" }), n += "</select>" } function n(e) { var n = "<select class='form-control ddlSizeId'>"; return $.each(t.sizes, function (t, a) { e === a.Id ? n += '<option value="' + a.Id + '" selected="select">' + a.Name + "</option>" : n += '<option value="' + a.Id + '">' + a.Name + "</option>" }), n += "</select>" } this.initialize = function () { $.ajax({ type: "GET", url: "/Admin/Bill/GetColors", dataType: "json", success: function (e) { t.colors = e }, error: function () { structures.notify("Có lỗi xảy ra", "error") } }), $.ajax({ type: "GET", url: "/Admin/Bill/GetSizes", dataType: "json", success: function (e) { t.sizes = e }, error: function () { structures.notify("Có lỗi xảy ra", "error") } }), $("body").on("click", ".btn-quantity", function (t) { t.preventDefault(); var a = $(this).data("id"); $("#hidId").val(a), $.ajax({ url: "/admin/Product/GetQuantities", data: { productId: $("#hidId").val() }, type: "get", dataType: "json", success: function (t) { var a = "", i = $("#template-table-quantity").html(); $.each(t, function (t, o) { a += Mustache.render(i, { Id: o.Id, Colors: e(o.ColorId), Sizes: n(o.SizeId), Quantity: o.Quantity }) }), $("#table-quantity-content").html(a), resetFile() } }), $("#modal-quantity-management").modal("show") }), $("body").on("click", ".btn-delete-quantity", function (t) { t.preventDefault(), $(this).closest("tr").remove() }), $("#btn-add-quantity").on("click", function () { var t = $("#template-table-quantity").html(), a = Mustache.render(t, { Id: 0, Colors: e(null), Sizes: n(null), Quantity: 0 }); $("#table-quantity-content").append(a) }), $("#btnSaveQuantity").on("click", function () { var t = []; $.each($("#table-quantity-content").find("tr"), function (e, n) { t.push({ Id: $(n).data("id"), ProductId: $("#hidId").val(), Quantity: $(n).find("input.txtQuantity").first().val(), SizeId: $(n).find("select.ddlSizeId").first().val(), ColorId: $(n).find("select.ddlColorId").first().val() }) }), $.ajax({ url: "/admin/Product/SaveQuantities", data: { productId: $("#hidId").val(), quantities: t }, type: "post", dataType: "json", success: function (t) { structures.notify("Thêm số lượng thành công.!", "success"), $("#modal-quantity-management").modal("hide"), $("#table-quantity-content").html("") } }) }) } };