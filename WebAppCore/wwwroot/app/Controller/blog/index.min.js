var BlogController = function () { function t() { $("#hidIdM").val(0), $("#txtNameM").val(""), $("#txtAliasM").val(""), CKEDITOR.instances.txtContentM.setData(""), $("#txtDescriptionM").val(""), $("#txtImage").val(""), $("#txtTagM").val(""), $("#txtMetakeywordM").val(""), $("#txtMetaDescriptionM").val(""), $("#txtSeoPageTitleM").val(""), $("#txtSeoAliasM").val(""), $("#ckStatusM").prop("checked", !0), $("#ckHotM").prop("checked", !1), $("#ckShowHomeM").prop("checked", !1) } function e(t) { $.ajax({ type: "GET", url: "/admin/Blog/GetAllPaging", data: { keyword: $("#txt-search-keyword").val(), page: structures.configs.pageIndex, pageSize: structures.configs.pageSize }, dataType: "json", beforeSend: function () { structures.startLoading() }, success: function (a) { var o = $("#table-template").html(), n = ""; a.RowCount > 0 ? ($.each(a.Results, function (t, e) { n += Mustache.render(o, { Name: e.Name, Alias: e.Alias, Id: e.Id, Status: structures.getStatus(e.Status) }) }), $("#lbl-total-records").text(a.RowCount), void 0 !== n && $("#tbl-content").html(n), function (t, e, a) { var o = Math.ceil(t / structures.configs.pageSize); 0 !== $("#paginationUL a").length && !0 !== a || ($("#paginationUL").empty(), $("#paginationUL").removeData("twbs-pagination"), $("#paginationUL").unbind("page")); $("#paginationUL").twbsPagination({ totalPages: o, visiblePages: 7, first: "Đầu", prev: "Trước", next: "Tiếp", last: "Cuối", onPageClick: function (t, a) { structures.configs.pageIndex = a, setTimeout(e(), 200) } }) }(a.RowCount, function () { e() }, t)) : $("#tbl-content").html(""), structures.stopLoading() }, error: function (t) { console.log(t) } }) } this.initialize = function () { e(), $("#frmMaintainance").validate({ errorClass: "red", ignore: [], lang: "en", rules: { txtNameM: { required: !0 }, txtAliasM: { required: !0 } } }), $("#txt-search-keyword").keypress(function (t) { 13 === t.which && (t.preventDefault(), e()) }), $("#btn-search").on("click", function () { e() }), $("#ddl-show-page").on("change", function () { structures.configs.pageSize = $(this).val(), structures.configs.pageIndex = 1, e(!0) }), $("#btn-create").on("click", function () { t(), $("#modal-add-edit").modal("show") }), $("body").on("click", ".btn-edit", function (t) { t.preventDefault(); var e = $(this).data("id"); $.ajax({ type: "GET", url: "/Admin/Blog/GetById", data: { id: e }, dataType: "json", beforeSend: function () { structures.startLoading() }, success: function (t) { var e = t; $("#hidIdM").val(e.Id), $("#txtNameM").val(e.Name), $("#txtAliasM").val(e.Alias), CKEDITOR.instances.txtContentM.setData(e.Content), $("#ckStatusM").prop("checked", 1 === e.Status), $("#modal-add-edit").modal("show"), structures.stopLoading(), $("#txtNameM").val(e.Name), $("#txtDescriptionM").val(e.Description), $("#txtImage").val(e.Image), $("#txtTagM").val(e.Tags), $("#txtMetakeywordM").val(e.SeoKeywords), $("#txtMetaDescriptionM").val(e.SeoDescription), $("#txtSeoPageTitleM").val(e.SeoPageTitle), $("#txtSeoAliasM").val(e.SeoAlias), $("#ckStatusM").prop("checked", 1 === e.Status), $("#ckHotM").prop("checked", e.HotFlag), $("#ckShowHomeM").prop("checked", e.HomeFlag), $("#modal-add-edit").modal("show"), structures.stopLoading() }, error: function () { structures.notify("Có lỗi xảy ra", "error"), structures.stopLoading() } }) }), $("#btnSaveM").on("click", function (a) { if ($("#frmMaintainance").valid()) { a.preventDefault(); var o = $("#hidIdM").val(), n = $("#txtNameM").val(), s = $("#txtMetakeywordM").val(), r = $("#txtMetaDescriptionM").val(), i = $("#txtSeoPageTitleM").val(), c = $("#txtSeoAliasM").val(), l = $("#txtTagM").val(), u = $("#txtImage").val(), d = $("#txtDescriptionM").val(), g = CKEDITOR.instances.txtContentM.getData(), p = !0 === $("#ckStatusM").prop("checked") ? 1 : 0, f = $("#ckHotM").prop("checked"), m = $("#ckShowHomeM").prop("checked"); return $.ajax({ type: "POST", url: "/Admin/Blog/SaveEntity", data: { Id: o, Name: n, Image: u, Description: d, Content: g, HomeFlag: m, HotFlag: f, Tags: l, Status: p, SeoPageTitle: i, SeoAlias: c, SeoKeywords: s, SeoDescription: r }, dataType: "json", beforeSend: function () { structures.startLoading() }, success: function () { structures.notify("Update page successful", "success"), $("#modal-add-edit").modal("hide"), t(), structures.stopLoading(), e(!0) }, error: function () { structures.notify("Have an error in progress", "error"), structures.stopLoading() } }), !1 } return !1 }), $("body").on("click", ".btn-delete", function (t) { t.preventDefault(); var a = $(this).data("id"); structures.confirm("Are you sure to delete?", function () { $.ajax({ type: "POST", url: "/Admin/Blog/Delete", data: { id: a }, dataType: "json", beforeSend: function () { structures.startLoading() }, success: function () { structures.notify("Delete page successful", "success"), structures.stopLoading(), e() }, error: function () { structures.notify("Have an error in progress", "error"), structures.stopLoading() } }) }) }), $("#btnSelectImg").on("click", function () { $("#fileInputImage").click() }), $("#fileInputImage").on("change", function () { for (var t = $(this).get(0), e = t.files, a = new FormData, o = 0; o < e.length; o++)a.append(e[o].name, e[o]); $.ajax({ type: "POST", url: "/Admin/Upload/UploadImage", contentType: !1, processData: !1, data: a, success: function (t) { $("#txtImage").val(t), structures.notify("Upload image succesful!", "success") }, error: function () { structures.notify("There was error uploading files!", "error") } }) }), CKEDITOR.replace("txtContentM", { filebrowserImageUploadUrl: "/Admin/Upload/UploadImageForCKEditor?type=Images" }), $.fn.modal.Constructor.prototype.enforceFocus = function () { $(document).off("focusin.bs.modal").on("focusin.bs.modal", $.proxy(function (t) { this.$element[0] === t.target || this.$element.has(t.target).length || $(t.target).closest(".cke_dialog, .cke").length || this.$element.trigger("focus") }, this)) } } };