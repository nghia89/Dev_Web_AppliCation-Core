var UserController = function () { function t(t) { $("#txtUserName").prop("disabled", t), $("#txtPassword").prop("disabled", t), $("#txtConfirmPassword").prop("disabled", t) } function e() { t(!1), $("#hidId").val(""), a(), $("#txtFullName").val(""), $("#txtUserName").val(""), $("#txtPassword").val(""), $("#txtConfirmPassword").val(""), $('input[name="ckRoles"]').removeAttr("checked"), $("#txtEmail").val(""), $("#txtPhoneNumber").val(""), $("#ckStatus").prop("checked", !0) } function a(t) { $.ajax({ url: "/Admin/Role/GetAll", type: "GET", dataType: "json", async: !1, success: function (e) { var a = $("#role-template").html(), r = e, s = ""; $.each(r, function (e, r) { var n = ""; void 0 !== t && -1 !== t.indexOf(r.Name) && (n = "checked"), s += Mustache.render(a, { Name: r.Name, Description: r.Description, Checked: n }) }), $("#list-roles").html(s) } }) } function r(t) { $.ajax({ type: "GET", url: "/admin/user/GetAllPaging", data: { categoryId: $("#ddl-category-search").val(), keyword: $("#txt-search-keyword").val(), page: structures.configs.pageIndex, pageSize: structures.configs.pageSize }, dataType: "json", beforeSend: function () { structures.startLoading() }, success: function (e) { var a = $("#table-template").html(), s = ""; e.RowCount > 0 ? ($.each(e.Results, function (t, e) { s += Mustache.render(a, { FullName: e.FullName, Id: e.Id, UserName: e.UserName, Avatar: void 0 === e.Avatar ? '<img src="/admin-side/images/user.png" width=25 />' : '<img src="' + e.Avatar + '" width=25 />', DateCreated: structures.dateTimeFormatJson(e.DateCreated), Status: structures.getStatus(e.Status) }) }), $("#lbl-total-records").text(e.RowCount), void 0 !== s && $("#tbl-content").html(s), function (t, e, a) { var r = Math.ceil(t / structures.configs.pageSize); 0 !== $("#paginationUL a").length && !0 !== a || ($("#paginationUL").empty(), $("#paginationUL").removeData("twbs-pagination"), $("#paginationUL").unbind("page")); $("#paginationUL").twbsPagination({ totalPages: r, visiblePages: 7, first: "Đầu", prev: "Trước", next: "Tiếp", last: "Cuối", onPageClick: function (t, a) { structures.configs.pageIndex = a, setTimeout(e(), 200) } }) }(e.RowCount, function () { r() }, t)) : $("#tbl-content").html(""), structures.stopLoading() }, error: function (t) { console.log(t) } }) } this.initialize = function () { r(), $("#frmMaintainance").validate({ errorClass: "red", ignore: [], lang: "en", rules: { txtFullName: { required: !0 }, txtUserName: { required: !0 }, txtPassword: { required: !0, minlength: 6 }, txtConfirmPassword: { equalTo: "#txtPassword" }, txtEmail: { required: !0, email: !0 } }, messages: { txtConfirmPassword: { required: "Bạn phải điền tên pass", equalTo: "pass không khớp với nhau" } } }), $("#txt-search-keyword").keypress(function (t) { 13 === t.which && (t.preventDefault(), r()) }), $("#btn-search").on("click", function () { r() }), $("#ddl-show-page").on("change", function () { structures.configs.pageSize = $(this).val(), structures.configs.pageIndex = 1, r(!0) }), $("#btn-create").on("click", function () { e(), a(), $("#modal-add-edit").modal("show") }), $("body").on("click", ".btn-edit", function (e) { e.preventDefault(); var r = $(this).data("id"); $.ajax({ type: "GET", url: "/Admin/User/GetById", data: { id: r }, dataType: "json", beforeSend: function () { structures.startLoading() }, success: function (e) { var r = e; $("#hidId").val(r.Id), $("#txtFullName").val(r.FullName), $("#txtUserName").val(r.UserName), $("#txtEmail").val(r.Email), $("#txtPhoneNumber").val(r.PhoneNumber), $("#ckStatus").prop("checked", 1 === r.Status), a(r.Roles), t(!0), $("#modal-add-edit").modal("show"), structures.stopLoading() }, error: function () { structures.notify("Có lỗi xảy ra", "error"), structures.stopLoading() } }) }), $("#btnSave").on("click", function (t) { if ($("#frmMaintainance").valid()) { t.preventDefault(); var a = $("#hidId").val(), s = $("#txtFullName").val(), n = $("#txtUserName").val(), o = $("#txtPassword").val(), i = $("#txtEmail").val(), u = $("#txtPhoneNumber").val(), c = []; $.each($('input[name="ckRoles"]'), function (t, e) { !0 === $(e).prop("checked") && c.push($(e).prop("value")) }); var d = !0 === $("#ckStatus").prop("checked") ? 1 : 0; $.ajax({ type: "POST", url: "/Admin/User/SaveEntity", data: { Id: a, FullName: s, UserName: n, Password: o, Email: i, PhoneNumber: u, Status: d, Roles: c }, dataType: "json", beforeSend: function () { structures.startLoading() }, success: function (t) { 0 != t ? (structures.notify("Save user succesful", "success"), $("#modal-add-edit").modal("hide"), e(), structures.stopLoading(), r(!0)) : (structures.notify("Email hoặc tài khoản đã tồn tại", "error"), structures.stopLoading()) } }) } return !1 }), $("body").on("click", ".btn-delete", function (t) { t.preventDefault(); var e = $(this).data("id"); structures.confirm("Are you sure to delete?", function () { $.ajax({ type: "POST", url: "/Admin/User/Delete", data: { id: e }, beforeSend: function () { structures.startLoading() }, success: function () { structures.notify("Delete successful", "success"), structures.stopLoading(), r() }, error: function () { structures.notify("Has an error", "error"), structures.stopLoading() } }) }) }) } };