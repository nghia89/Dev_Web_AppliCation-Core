var productCategoryController = function () { function e(e) { $.ajax({ url: "/Admin/ProductCategory/GetAll", type: "GET", dataType: "json", async: !1, success: function (t) { var r = []; $.each(t, function (e, t) { r.push({ id: t.Id, text: t.Name, parentId: t.ParentId, sortOrder: t.SortOrder }) }); var a = structures.unflattern(r); $("#ddlCategoryIdM").combotree({ data: a }), void 0 !== e && $("#ddlCategoryIdM").combotree("setValue", e) } }) } function t() { $.ajax({ url: "/Admin/ProductCategory/GetAll", dataType: "json", success: function (e) { var r = []; $.each(e, function (e, t) { r.push({ id: t.Id, text: t.Name, parentId: t.ParentId, sortOrder: t.SortOrder }) }); var a = structures.unflattern(r); a.sort(function (e, t) { return e.sortOrder - t.sortOrder }), $("#treeProductCategory").tree({ data: a, dnd: !0, onContextMenu: function (e, t) { e.preventDefault(), $("#hidIdM").val(t.id), $("#contextMenu").menu("show", { left: e.pageX, top: e.pageY }) }, onDrop: function (e, r, a) { console.log(e), console.log(r), console.log(a); var o = $(this).tree("getNode", e); if ("append" === a) { var n = []; $.each(o.children, function (e, t) { n.push({ key: t.id, value: e }) }), $.ajax({ url: "/Admin/ProductCategory/UpdateParentId", type: "post", dataType: "json", data: { sourceId: r.id, targetId: o.id, items: n }, success: function (e) { t() } }) } else "top" !== a && "bottom" !== a || $.ajax({ url: "/Admin/ProductCategory/ReOrder", type: "post", dataType: "json", data: { sourceId: r.id, targetId: o.id }, success: function (e) { t() } }) } }) } }) } this.initialize = function () { t(), $("#frmMaintainance").validate({ errorClass: "red", ignore: [], lang: "en", rules: { txtNameM: { required: !0 }, txtOrderM: { number: !0 }, txtHomeOrderM: { number: !0 } } }), $("#btnCreate").off("click").on("click", function () { e(), $("#modal-add-edit").modal("show") }), $("#btnSelectImg").on("click", function () { $("#fileInputImage").click() }), $("#fileInputImage").on("change", function () { for (var e = $(this).get(0), t = e.files, r = new FormData, a = 0; a < t.length; a++)r.append(t[a].name, t[a]); $.ajax({ type: "POST", url: "/Admin/Upload/UploadImage", contentType: !1, processData: !1, data: r, success: function (e) { $("#txtImage").val(e), structures.notify("Upload image succesful!", "success") }, error: function () { structures.notify("There was error uploading files!", "error") } }) }), $("body").on("click", "#btnEdit", function (t) { t.preventDefault(); var r = $("#hidIdM").val(); $.ajax({ type: "GET", url: "/Admin/ProductCategory/GetById", data: { id: r }, dataType: "json", beforeSend: function () { structures.startLoading() }, success: function (t) { var r = t; $("#hidIdM").val(r.Id), $("#txtNameM").val(r.Name), e(r.CategoryId), $("#txtDescM").val(r.Description), $("#txtImage").val(r.Image), $("#txtSeoKeywordM").val(r.SeoKeywords), $("#txtSeoDescriptionM").val(r.SeoDescription), $("#txtSeoPageTitleM").val(r.SeoPageTitle), $("#txtSeoAliasM").val(r.SeoAlias), $("#ckStatusM").prop("checked", 1 === r.Status), $("#ckShowHomeM").prop("checked", r.HomeFlag), $("#txtOrderM").val(r.SortOrder), $("#txtHomeOrderM").val(r.HomeOrder), $("#modal-add-edit").modal("show"), structures.stopLoading() }, error: function (e) { structures.notify("Có lỗi xảy ra", "error"), structures.stopLoading() } }) }), $("body").on("click", "#btnDelete", function (e) { e.preventDefault(); var r = $("#hidIdM").val(); structures.confirm("Are you sure to delete?", function () { $.ajax({ type: "POST", url: "/Admin/ProductCategory/Delete", data: { id: r }, dataType: "json", beforeSend: function () { structures.startLoading() }, success: function (e) { structures.notify("Deleted success", "success"), structures.stopLoading(), t() }, error: function (e) { structures.notify("Has an error in deleting progress", "error"), structures.stopLoading() } }) }) }), $("#btnSave").on("click", function (r) { if ($("#frmMaintainance").valid()) { r.preventDefault(); var a = parseInt($("#hidIdM").val()), o = $("#txtNameM").val(), n = $("#ddlCategoryIdM").combotree("getValue"), d = $("#txtDescM").val(), s = $("#txtImage").val(), c = parseInt($("#txtOrderM").val()), i = $("#txtHomeOrderM").val(), u = $("#txtSeoKeywordM").val(), l = $("#txtSeoDescriptionM").val(), p = $("#txtSeoPageTitleM").val(), f = $("#txtSeoAliasM").val(), g = !0 === $("#ckStatusM").prop("checked") ? 1 : 0, m = $("#ckShowHomeM").prop("checked"); $.ajax({ type: "POST", url: "/Admin/ProductCategory/SaveEntity", data: { Id: a, Name: o, Description: d, ParentId: n, HomeOrder: i, SortOrder: c, HomeFlag: m, Image: s, Status: g, SeoPageTitle: p, SeoAlias: f, SeoKeywords: u, SeoDescription: l }, dataType: "json", beforeSend: function () { structures.startLoading() }, success: function (r) { structures.notify("Update success", "success"), $("#modal-add-edit").modal("hide"), $("#hidIdM").val(0), $("#txtNameM").val(""), e(""), $("#txtDescM").val(""), $("#txtOrderM").val(""), $("#txtHomeOrderM").val(""), $("#txtImageM").val(""), $("#txtMetakeywordM").val(""), $("#txtMetaDescriptionM").val(""), $("#txtSeoPageTitleM").val(""), $("#txtSeoAliasM").val(""), $("#ckStatusM").prop("checked", !0), $("#ckShowHomeM").prop("checked", !1), structures.stopLoading(), t() }, error: function (e) { var t = e.responseJSON.Message; structures.notify(t, "error"), structures.stopLoading() } }) } return !1 }) } };